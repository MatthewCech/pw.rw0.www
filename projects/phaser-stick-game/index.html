<!DOCTYPE html>
<html>
    <head>
        <!-- meta tags -->
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- external links -->
        <script type="text/javascript" src="resources/js/phaser.min.js"></script>

        <!-- page config -->
        <title>Web Experiment</title>
    </head>
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }
    </style>
    <body>
        <script>
            function ButtonPress() {
                //does things
                // 1
                // 2
                // 3
            }

          ///////////////////
         // Create Levels //
        ///////////////////
        // Main level
        class Level1 extends Phaser.State {
            // Variables

            // ===== Phaser Functions ===== //
            // First call for constructor.
            constructor(game){ super(game); 

                // Actual ctor content here.
                this.player = null;
                this.move_speed = 500;
                this.punch_speed = 2250;
                this.jump_speed = 1200;
                this.punch_right_trigger = false;
                this.punch_left_trigger = false;
            }

            // Configuration goes here. This is called first after construction.
            preload() {
                // Spritesheets
                game.load.spritesheet('player', 'resources/assets/Movement.png', 32, 32);

                // Game load audio
                game.load.audio('music', 'resources/assets/Fighting Man - DJ Pone & Drixxxe - (The Transporter).mp3')
            }

            // Put things to be regularly initialized once here. 
            create() {
                // Configure world
                game.physics.startSystem(Phaser.Physics.ARCADE);
                game.stage.backgroundColor = "#EEEEEE";
                game.physics.arcade.gravity.y = 3000;

                // Add player
                this.player = game.add.sprite(0, 0 /*window.innerHeight - 64*/, 'player');
                this.player.scale.setTo(2, 2);
                this.player.smoothed = false;
                this.player.animations.add('idle', [6, 7], 2, true);
                this.player.animations.add('walk_left', [0, 1, 2, 3, 4, 5], 10, true);
                this.player.animations.add('walk_right', [8, 9, 10, 11, 12, 13], 10, true);
                this.player.animations.add('punch_right', [14], 4, true);
                this.player.animations.add('punch_left', [15], 4, true);
                this.player.animations.add('jump_right', [16], 4, true);
                this.player.animations.add('jump_left', [17], 4, true);
                this.player.animations.add('fall_right', [19], 4, true);
                this.player.animations.add('fall_left', [18], 4, true);
                game.physics.enable(this.player, Phaser.Physics.ARCADE);
                this.player.enableBody = true;
                this.player.body.collideWorldBounds = true;
                

                // squeak sound Setup
                this.music = game.add.audio('music');
                //this.music.play(); // PLAY MUSIC WITH THIS LINE
            }

            emit(mouse_ptr){
                this.kickdrum.play();
            }


            // Called once per loop.
            update() {
                let punched = false;
                if(game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)) {
                    punched = true;
                    if(this.punch_right_trigger == false) {
                        this.player.animations.play('punch_right');
                        this.punch_right_trigger = true;
                        this.player.body.velocity.x = this.punch_speed;
                    }
                } else {
                    this.punch_right_trigger = false;
                }

                if(game.input.keyboard.isDown(Phaser.Keyboard.LEFT)) {
                    punched = true;
                    if(this.punch_left_trigger == false) {
                        this.player.animations.play('punch_left');
                        this.punch_left_trigger = true;
                        this.player.body.velocity.x = -this.punch_speed;
                    }
                } else {
                    this.punch_left_trigger = false;
                }


                // Jumping
                if(this.player.body.blocked.down == true) {
                    if(game.input.keyboard.isDown(Phaser.Keyboard.W) 
                    || game.input.keyboard.isDown(Phaser.Keyboard.UP)
                    || game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)) {
                        this.player.body.velocity.y = -this.jump_speed;
                    }
                }


                // Playing animations for moving to the left and right - please note that punching
                // overrides this pretty hardcore, so we only do it if we *haven't* punched yet.
                // Otherwise, we're good to go.
                if(punched == false) {    
                    if(game.input.keyboard.isDown(Phaser.Keyboard.D)) {
                        if(this.player.body.blocked.down == true)
                            this.player.animations.play('walk_right');
                        this.player.body.velocity.x = this.move_speed;
                    }
                    else if(game.input.keyboard.isDown(Phaser.Keyboard.A)) {
                        if(this.player.body.blocked.down == true)
                            this.player.animations.play('walk_left');
                        this.player.body.velocity.x = -this.move_speed;
                    } else {
                            this.player.animations.play('idle');
                    }

                    // If we're moving vertically up...
                    if(this.player.body.velocity.y < -1) {
                        if(this.player.body.blocked.down == false)
                            this.player.animations.play('jump_left');

                        if(this.player.body.velocity.x > 0)
                            if(this.player.body.blocked.down == false)
                                this.player.animations.play('jump_right');
                    } 
                    // If we're moving vertically down...
                    else if (this.player.body.velocity.y > 1) {
                        if(this.player.body.blocked.down == false)
                            this.player.animations.play('fall_left');

                        if(this.player.body.velocity.x > 0)
                            if(this.player.body.blocked.down == false)
                                this.player.animations.play('fall_right');
                    }
                }




                // Slow player over time.
                this.player.body.velocity.x *= 0.7;

                // Call draw upkeep
                this.draw(); // Should be called last.
            }

            // ===== Recommended Functions ===== //
            // Initialization (and by extention re-initialization or restart code here.)
            init() {
            }
            
            // Draw code here!
            draw() {
            }
        }

          //////////////////
         // Phaser Setup //
        //////////////////
        // Get game object and add levels. Note: This must come last.
        // Note: Consider scaling by window.devicePixelRatio.
        var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.AUTO, '');  // Initialize the phaser window
        game.state.add('level_main', new Level1(game));                                      // Add your levels like this.
        game.state.start('level_main');                                                      // Dictates starting "Level".

        </script>
    </body>
</html>